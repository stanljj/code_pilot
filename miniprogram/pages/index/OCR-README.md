# 小程序OCR功能使用说明

## 功能概述

小程序OCR功能允许用户通过拍照或选择图片来识别图片中的文字内容，然后将识别结果提交给CodePilot进行分析和处理。

## 功能特性

### 1. 图片获取方式
- **拍照**: 直接使用手机摄像头拍照
- **选择图片**: 从手机相册中选择已有图片
- **图片预览**: 选择图片后可预览图片内容
- **图片清除**: 可随时清除已选择的图片

### 2. 操作流程
1. 在首页点击"拍照"或"选择图片"按钮
2. 完成拍照或选择图片操作
3. 预览图片确认无误
4. 点击"识别图片并提问"按钮
5. 等待OCR识别和AI分析
6. 查看识别结果和分析建议

### 3. 界面说明

#### OCR功能区域
- **标题**: "拍照识码" - 清晰标识OCR功能
- **操作按钮**: 
  - 📷 选择图片 - 从相册选择
  - 📸 拍照 - 调用摄像头
- **图片预览**: 选择图片后显示缩略图
- **清除按钮**: 红色按钮用于清除当前选择的图片
- **提交按钮**: 识别图片并提问

## 技术实现

### 前端实现
- **文件**: `pages/index/index.js`
- **核心方法**:
  - `onChooseImage()`: 选择图片
  - `onTakePhoto()`: 拍照
  - `onClearImage()`: 清除图片
  - `onOcrSubmit()`: OCR提交处理

### API接口
- **文件**: `utils/api.js`
- **方法**: `ocrAsk(imagePath, sessionId, source)`
- **请求方式**: POST multipart/form-data
- **接口地址**: `/api/v1/ask/ocr`

### 网络请求
- **文件**: `utils/request.js`
- **支持文件上传**: 通过`wx.uploadFile`实现
- **认证方式**: Basic Auth (demo:demo)

## 使用示例

### 场景1: 识别代码截图
```
1. 点击"选择图片"按钮
2. 从相册选择代码截图
3. 点击"识别图片并提问"
4. 系统自动识别代码并提供分析
```

### 场景2: 拍照识别错误信息
```
1. 点击"拍照"按钮
2. 拍摄错误提示界面
3. 点击"识别图片并提问"
4. 系统分析错误并提供解决方案
```

## 注意事项

1. **图片要求**: 
   - 支持常见图片格式(JPG/PNG等)
   - 建议图片清晰，文字可辨识
   - 单张图片大小限制根据后端配置

2. **网络要求**:
   - 需要网络连接
   - 确保后端服务正常运行
   - 开发者工具需勾选"不校验合法域名"

3. **权限设置**:
   - 需要相机和相册访问权限
   - 首次使用会提示授权

4. **错误处理**:
   - 网络错误会显示相应提示
   - OCR识别失败会给出友好提示
   - 可重新尝试操作

## 扩展功能

### 可能的优化方向
1. **批量处理**: 支持多张图片同时识别
2. **语言识别**: 自动识别图片中的编程语言
3. **结果编辑**: 允许用户编辑识别结果后再提交
4. **历史记录**: 保存OCR识别历史
5. **离线缓存**: 网络异常时的缓存处理

## 调试建议

1. 使用微信开发者工具进行调试
2. 检查网络请求是否正常
3. 确认后端OCR接口可用
4. 验证图片上传功能正常